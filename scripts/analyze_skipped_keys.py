import json
from collections import defaultdict

ARABIC_SURAH_MAP = {
    "الفاتحة": 1, "البقرة": 2, "آل عمران": 3, "النساء": 4, "المائدة": 5, "الأنعام": 6, "الأعراف": 7, "الأنفال": 8, "التوبة": 9, "يونس": 10,
    "هود": 11, "يوسف": 12, "الرعد": 13, "ابراهيم": 14, "إبراهيم": 14, "الحجر": 15, "النحل": 16, "الإسراء": 17, "الكهف": 18, "مريم": 19, "طه": 20,
    "الأنبياء": 21, "الحج": 22, "المؤمنون": 23, "النور": 24, "الفرقان": 25, "الشعراء": 26, "النمل": 27, "القصص": 28, "العنكبوت": 29, "الروم": 30,
    "لقمان": 31, "السجدة": 32, "الأحزاب": 33, "سبأ": 34, "فاطر": 35, "يس": 36, "الصافات": 37, "ص": 38, "الزمر": 39, "غافر": 40,
    "فصلت": 41, "الشورى": 42, "الزخرف": 43, "الدخان": 44, "الجاثية": 45, "الأحقاف": 46, "محمد": 47, "الفتح": 48, "الحجرات": 49, "ق": 50,
    "الذاريات": 51, "الطور": 52, "النجم": 53, "القمر": 54, "الرحمن": 55, "الواقعة": 56, "الحديد": 57, "المجادلة": 58, "الحشر": 59, "الممتحنة": 60,
    "الصف": 61, "الجمعة": 62, "المنافقون": 63, "التغابن": 64, "الطلاق": 65, "التحريم": 66, "الملك": 67, "القلم": 68, "الحاقة": 69, "المعارج": 70,
    "نوح": 71, "الجن": 72, "المزمل": 73, "المدثر": 74, "القيامة": 75, "الانسان": 76, "الإنسان": 76, "المرسلات": 77, "النبأ": 78, "النازعات": 79, "عبس": 80,
    "التكوير": 81, "الانفطار": 82, "المطففين": 83, "الانشقاق": 84, "البروج": 85, "الطارق": 86, "الأعلى": 87, "الغاشية": 88, "الفجر": 89, "البلد": 90,
    "الشمس": 91, "الليل": 92, "الضحى": 93, "الشرح": 94, "التين": 95, "العلق": 96, "القدر": 97, "البينة": 98, "الزلزلة": 99, "العاديات": 100,
    "القارعة": 101, "التكاثر": 102, "العصر": 103, "الهمزة": 104, "الفيل": 105, "قريش": 106, "الماعون": 107, "الكوثر": 108, "الكافرون": 109, "النصر": 110,
    "المسد": 111, "الاخلاص": 112, "الإخلاص": 112, "الفلق": 113, "الناس": 114
}

def analyze():
    master_path = '/home/absolut7/Documents/ihya_love/ihya_tafsir_master.json'
    with open(master_path, 'r', encoding='utf-8') as f:
        master_data = json.load(f)

    skipped = []
    
    for item in master_data:
        s_id = str(item.get('surah', ''))
        verse_key = item.get('verse_key', '')
        
        # Copied logic from injection script
        if not s_id.isdigit():
             if ':' in verse_key:
                 parts = verse_key.split(':')
                 s_part = parts[0].strip()
                 if s_part in ARABIC_SURAH_MAP:
                     s_id = str(ARABIC_SURAH_MAP[s_part])
                 elif s_part.isdigit():
                     s_id = s_part
        
        if not s_id.isdigit() and s_id in ARABIC_SURAH_MAP:
            s_id = str(ARABIC_SURAH_MAP[s_id])
            
        if not s_id.isdigit():
            skipped.append(f"{verse_key} (Surah field: {item.get('surah', '')})")

    print(f"Total Skipped: {len(skipped)}")
    print("Sample Skipped Keys:")
    for k in skipped[:20]:
        print(k)

if __name__ == "__main__":
    analyze()
